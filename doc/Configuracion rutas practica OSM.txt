#VNXLAB2022-v3
export OSMNS=7b2950d8-f92b-4041-9a55-8d1837ad7b0a

# copia  de cosas
# ya est치 copiado 
# microk8s kubectl -n $OSMNS cp /usr/bin/vnx_config_nat $VCPE1_CPE:/usr/bin

microk8s kubectl -n $OSMNS cp conf/dhcpd-1.conf $VCPE1_CPE:/etc/dhcp/dhcpd.conf


IP_ACCESS=`microk8s kubectl exec -n $OSMNS -it $VCPE1_ACCESS -- hostname`
IP_CPE=`microk8s kubectl exec -n $OSMNS -it $VCPE1_CPE -- hostname`

#ACCESS KNF
#hacia AccessNet1
#ifconfig net1 10.255.0.1/24

#hacia bridgeosm no hace falta, usamos mgmntnet
# ifconfig net2 192.168.200.1/24

service openvswitch-switch start
ovs-vsctl add-br brint

ovs-vsctl add-port brint vxlanacc22 -- set interface vxlanacc22 type=vxlan options:remote_ip=10.255.0.2 options:key=inet options:dst_port=8742

ovs-vsctl add-port brint accesstocpe2 -- set interface accesstocpe2 type=vxlan options:remote_ip=192.168.200.2 options:key=inet options:dst_port=8742

#CPE KNF
#hacia ExtNet1
#ifconfig net1 10.100.1.1/24

#hacia bridgeosm, no hace falta, usamos mgmntnet
# ifconfig net2 192.168.200.2/24

ifconfig brint 192.168.255.1

service openvswitch-switch start
ovs-vsctl add-br brint

ovs-vsctl add-port brint vxlanacc22 -- set interface vxlanacc22 type=vxlan options:remote_ip=10.255.0.2 options:key=inet options:dst_port=8742

ovs-vsctl add-port brint cpetoaccess2 -- set interface cpetoaccess2 type=vxlan options:remote_ip=192.168.200.1 options:key=inet options:dst_port=8742



cd usr/bin
apt-get install iptables
vnx_config_nat brint net1

apt-get install isc-dhcp-server
service isc-dhcp-server restart

ip route del 0.0.0.0/0 via 169.254.1.1
ip route add 0.0.0.0/0 via 10.100.1.254

# COSAS QUE HACER
en RDSV-k8 rm /home/upm/.docker/config.json


DONE: Cambiar el docker de la m치quina para que tenga iptables,  isc-dhcp-server  y el vnx_config_nat 

Cambiar la m치quina virtual de osm para que tenga autocompletar. Receta:
```
mkdir -p $HOME/.bash_completion.d
_OSM_COMPLETE=bash_source osm > $HOME/.bash_completion.d/osm-complete.sh
echo '. .bash_completion.d/osm-complete.sh' >> $HOME/.bashrc
# opcional, para no rearrancar el terminal
source $HOME/.bashrc
```

Habilitar la MV para que los escenarios VNX puedan lanzar herramientas gr치ficas



